<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE  mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="reportMapper">
	
	<insert id="insert" parameterType="hashMap" useGeneratedKeys="true" keyProperty="book_id">  
	    insert into book
	    (title, category, price) 
	    values
	    (#{title}, #{category}, #{price})
	</insert>
	
	<select id="getPortFolioList" parameterType="hashMap" resultType="HashMap">  
	    select
		    a.CORP_CODE,
		    a.ACCOUNT_ID,
		    a.NET_AMOUNT,
		    a.ACCUMULATED_NET_AMOUNT,
		    lead(a.ACCUMULATED_NET_AMOUNT)
		    over(partition by a.CORP_CODE, a.ACCOUNT_ID
		         order by
		             a.CORP_CODE, a.BSNS_YEAR desc, a.REPRT_CODE asc
		    ) as "LEAD_ACCUMULATED_NET_AMOUNT",
		    a.BSNS_YEAR,
		    a.REPRT_CODE
		from
		    TB_BPLC_CIS a, TB_BPLC b
		where
		        a.CORP_CODE = b.STOCK_CODE
		where 1=1
		    and ( b.CORP_NAME = '삼성전자' )
		order by
		    a.CORP_CODE,
		    a.ACCOUNT_ID,
		    a.BSNS_YEAR desc,
		    a.REPRT_CODE
	</select>
	
	<select id="getReportDetailList" parameterType="hashMap" resultType="HashMap">  
	
	SELECT 	CORP_CODE, CORP_NAME, BSNS_YEAR, REPRT_CODE,
			sj_div, account_id, 
			NET_AMOUNT, ROUND(((NET_AMOUNT - LEAD_NET_AMOUNT) / DECODE(NET_AMOUNT, 0, NULL, NET_AMOUNT) * 100), 2) AS NET_AMOUNT_RATE,
			ACC_NET_AMOUNT, ROUND(((ACC_NET_AMOUNT - LEAD_ACC_NET_AMOUNT) / DECODE(LEAD_ACC_NET_AMOUNT, 0, NULL, LEAD_ACC_NET_AMOUNT) * 100), 2) AS ACC_NET_AMOUNT_RATE, 
			BEF_NET_AMOUNT, ROUND(((BEF_NET_AMOUNT - LEAD_BEF_NET_AMOUNT) / DECODE(LEAD_BEF_NET_AMOUNT, 0, NULL, LEAD_BEF_NET_AMOUNT) * 100), 2) AS BEF_NET_AMOUNT_RATE, 
			BEF_ACC_NET_AMOUNT, ROUND(((BEF_ACC_NET_AMOUNT - LEAD_BEF_ACC_NET_AMOUNT) / DECODE(LEAD_BEF_ACC_NET_AMOUNT, 0, NULL, LEAD_BEF_ACC_NET_AMOUNT) * 100), 2) AS BEF_ACC_NET_AMOUNT_RATE
	FROM (
	    SELECT
	        a.corp_code, b.corp_name, a.bsns_year, a.reprt_code,
	        a.sj_div, a.account_id, 
	        nvl(a.net_amount,0) as net_amount, lead(nvl(a.net_amount,0)) over (partition by a.corp_code, a.account_id order by a.corp_code, a.bsns_year desc, a.reprt_code asc) as lead_net_amount,
	        nvl(a.accumulated_net_amount,0) as acc_net_amount, lead(nvl(a.accumulated_net_amount,0)) over (partition by a.corp_code, a.account_id order by a.corp_code, a.bsns_year desc, a.reprt_code asc) as lead_acc_net_amount,
	        nvl(a.bef_net_amount,0) as bef_net_amount,  lead(nvl(a.bef_net_amount,0)) over (partition by a.corp_code, a.account_id order by a.corp_code, a.bsns_year desc, a.reprt_code asc) as lead_bef_net_amount,
	        nvl(a.bef_accumulated_net_amount,0) as bef_acc_net_amount, lead(nvl(a.bef_accumulated_net_amount,0)) over (partition by a.corp_code, a.account_id order by a.corp_code, a.bsns_year desc, a.reprt_code asc) as lead_bef_acc_net_amount
	    FROM
	        tb_bplc_cis a INNER JOIN tb_bplc b 
	        ON a.corp_code = b.stock_code
	        where 1=1
	        order by a.corp_code, a.account_id, a.bsns_year desc, a.reprt_code asc
	)
    </select>
</mapper>