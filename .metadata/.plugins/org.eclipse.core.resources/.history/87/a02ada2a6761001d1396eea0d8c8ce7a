<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE  mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="portfolioMapper">
	
	<select id="getPortfolio" parameterType="Map" resultType="HashMap">  
	    select 
	    	USER_ID, DEPOSIT_AMOUNT, INVEST_AMOUNT, RESERVE_AMOUNT, CREATE_ID, CREATE_DT, CHANGE_ID, CHANGE_DT, MEMO
	    from TB_PORTFOLIO
	</select>
	
	<select id="getPortCorpList" parameterType="Map" resultType="HashMap">  
	    select 
	    	CORP_CODE,USER_ID,CORP_NAME,STOCK_CODE,GUBN,CREATE_ID,CREATE_DT,CHANGE_ID,CHANGE_DT,MEMO,INVEST_OPINION,HOLD_QUANTITY,AVR_PRICE
	    from TB_PORTFOLIO_CORP
	</select>
	
	<insert id="insertPortfolioCorp" parameterType="hashMap"  >  
		MERGE 
		 	INTO TB_PORTFOLIO_CORP a
		USING dual
		   ON (
		   		a.CORP_CODE = #{CORP_CODE}
		   		and a.USER_ID = 'SYSTEM_JB' 
		   	)
		 WHEN MATCHED THEN
		      UPDATE
		         SET 
		         	a.CHANGE_ID = 'SYSTEM_JB',
		          	a.CHANGE_DT = TO_CHAR(SYSDATE,'YYYY-MM-DD')
		 WHEN NOT MATCHED THEN
				INSERT (
				    CORP_CODE,USER_ID,CORP_NAME,STOCK_CODE,GUBN,
				    CREATE_ID,CREATE_DT,CHANGE_ID,CHANGE_DT,MEMO	
				) VALUES (
					#{CORP_CODE}, 'SYSTEM_JB' ,#{CORP_NAME} ,#{STOCK_CODE} , '',
				    'SYSTEM_JB' ,TO_CHAR(SYSDATE,'YYYY-MM-DD') ,'SYSTEM_JB' ,TO_CHAR(SYSDATE,'YYYY-MM-DD'),''
				)
	    
	</insert>
	
	<insert id="updatePortfolioAsset" parameterType="Map"  >  
		UPDATE
			TB_PORTFOLIO
			<set>
				<if test="DEPOSIT_AMOUNT != null and DEPOSIT_AMOUNT != '' ">
					DEPOSIT_AMOUNT		=	#{DEPOSIT_AMOUNT},
				</if>
				<if test="RESERVE_AMOUNT != null and RESERVE_AMOUNT != '' ">
					RESERVE_AMOUNT		=	#{RESERVE_AMOUNT},
				</if>
				CHANGE_DT 		=	SYSDATE,
				CHANGE_ID		=	'SYSTEM_JB'
			</set>
		WHERE
			USER_ID = 'SYSTEM_JB'
	    
	</insert>
	
	<insert id="deletePortfolioCorp" parameterType="hashMap"  >  
	    DELETE  TB_PORTFOLIO_CORP 
	    WHERE 1=1
	    <if test="delCorpCnt != 0 ">
			AND CORP_CODE IN 
			<foreach collection="delCorpList" item="item" open="(" close=")" separator=",">
				#{item}
			</foreach>
		</if>
	    AND USER_ID = 'SYSTEM_JB'
	</insert>
</mapper>